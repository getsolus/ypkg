actions:
    - cargo_fetch: |
        cargo fetch -v --locked

    - cargo_build: |
        cargo build %options_cargo_release%

    - cargo_cbuild: |
        cargo cbuild %options_cargo_cbuild%

    - cargo_install: |
        cargo_install(){
            if [ $# -gt 0 ]; then
                for binary in "$@"; do
                    install -Dm00755 %cargo_target_dir%/"$binary" $installdir/usr/bin/"$binary"
                done
            else
                install -Dm00755 %cargo_target_dir%/"$package" $installdir/usr/bin/"$package"
            fi
        }
        cargo_install

    - cargo_cinstall: |
        cargo cinstall %options_cargo_cbuild% \
            --destdir=$installdir \
            --libdir=%libdir%

    - cargo_test: |
        cargo test %options_cargo_release% --workspace

defines:
    - cargo_profile: "release"
    - cargo_target_dir: "target/%cargo_profile%/"
    - options_cargo: |
        -v -j "%YJOBS%" --frozen
    - options_cargo_release: |
        %options_cargo% --release \
            --config profile.release.debug=\"full\" \
            --config profile.release.split-debuginfo=\"off\" \
            --config profile.release.lto=\"off\" \
            --config profile.release.strip=\"none\"
    - options_cargo_cbuild: |
        %options_cargo% --release \
            --prefix=%PREFIX%
