actions:
    - patch: |
        patch -t -E --no-backup-if-mismatch -f

    # Only works if the user has a series file. They can provide the name to
    # override 'series' if needed
    - apply_patches: |
        function apply_patches() {
            if [[ ! -z "$1" ]]; then
                srs="$pkgfiles/$1"
            else
                srs="$pkgfiles/series"
            fi
            test -e "$srs" || exit 1
            while read -r pname ; do
                if [[ "$pname" == "" ]]; then
                    continue
                fi
                %patch -p1 -i $pkgfiles/$pname
            done < $srs
        }
        apply_patches

    - avx2_lib_shift: |
        if [ -d "%installroot%/%libdir%" ]; then
          install -dm00755 $PKG_BUILD_DIR/glibc-hwcaps/x86-64-v3
          mv %installroot%/%libdir%/* $PKG_BUILD_DIR/glibc-hwcaps/x86-64-v3
          mv $PKG_BUILD_DIR/glibc-hwcaps %installroot%/%libdir%/
        fi

    # Check for broken symlinks, turn from error into warning by setting SYMLINK_WARN
    - symlink_check: |
        if [[ -n "$(find $installdir -xtype l)" ]]; then
            echo "Broken symlinks found! See above."
            if [[ -z "$SYMLINK_WARN" ]]; then
                exit 1;
            fi
        else
            echo "No broken symlinks found.";
        fi

defines:
    # Get LTS kernel version
    - kernel_version_lts: |
        $(echo "$(basename `readlink /usr/lib/kernel/default-lts` | cut -d '.' -f 4,5,6)".lts)

    # Get "Current" kernel version
    - kernel_version_current: |
        $(echo "$(basename `readlink /usr/lib/kernel/default-current` | cut -d '.' -f 4,5,6)".current)
