actions:
    # Make life easier with Perl
    - perl_setup:
        description: Runs Perl setup scripts Build.pl or Makefile.pl with the appropriate variable flags.
        command: |
            function perl_setup() {
                if [[ -e Makefile.PL ]]; then
                    perl Makefile.PL PREFIX=%PREFIX% INSTALLDIRS=vendor DESTDIR="%installroot%" $* || exit
                else
                    perl Build.PL installdirs=vendor create_packlist=0 $* || exit 1
                fi
            }
            perl_setup

    - perl_build:
        description: Runs Perl build scripts or attempts %make.
        command: |
            function perl_build() {
                if [[ -e Makefile.PL ]]; then
                    %make $* || exit 1
                else
                    perl Build installdirs=vendor create_packlist=0 $* || exit 1
                fi
            }
            perl_build

    # We need to nuke use of privlib because its always a perllocal.pod situation,
    # and these macros explicitly use vendor libs
    - perl_install:
        description: Runs Perl install scripts or attempts %make_install.
        command: |
            function perl_install() {
                if [[ -e Makefile.PL ]]; then
                    %make_install $* || exit 1
                else
                    perl Build destdir="%installroot%" install $* || exit 1
                fi
                priv_lib="%perl_privlib%"
                if [[ -e "$installdir/$priv_lib" ]]; then
                    rm -rfv "$installdir/$priv_lib"
                fi
            }
            perl_install

defines:
    # Inspired by the RPM guys :]
    - perl_privlib: |
        $(eval `perl -V:installprivlib`; echo $installprivlib)
